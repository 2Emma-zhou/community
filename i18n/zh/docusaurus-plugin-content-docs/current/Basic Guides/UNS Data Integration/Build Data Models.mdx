---
hide_title: true
sidebar_label: 建立数据模型
---

Tier0 采用统一命名空间（UNS）将数据组织成清晰的树形结构，模型中的每个节点都会按照树形图自动生成 MQTT 主题，方便获取实时数据。

## 开始前注意事项

### 页面概览
登录 Tier0 后，选择**数据管理** > **数据建模**，进入模块主页面。

<img width={650} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/102-1.png" />

<table>
  <thead>
    <tr>
      <th>序号</th>
      <th>项目</th>
      <th>说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td rowspan="3">1</td>
      <td>工厂模型</td>
      <td>已在 UNS 中创建的数据模型树形视图</td>
    </tr>
    <tr>
      <td>模板</td>
      <td>已在 UNS 中创建的数据模型模板树形视图</td>
    </tr>
    <tr>
      <td>标签</td>
      <td>显示标签及每个标签下的关联模型</td>
    </tr>
    <tr>
      <td rowspan="4">2</td>
      <td><img src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/103.png" /></td>
      <td>按类别展示数据模型：<b>文本/模板/标签</b>。</td>
    </tr>
    <tr>
      <td><img src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/104.png" />/<img src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/105.png" /></td>
      <td>搜索数据模型 / 刷新数据模型列表。</td>
    </tr>
    <tr>
      <td><img src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/5.png" />/<img src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/7.png" /></td>
      <td>根据数据层级，创建**文件夹-文件**结构的数据模型。</td>
    </tr>
    <tr>
      <td><img src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/40.png" /></td>
      <td>通过手动输入 JSON 文本创建数据模型。</td>
    </tr>
    <tr>
      <td>3</td>
      <td>导入/导出</td>
      <td>以 JSON 或 Excel 格式导入/导出数据模型</td>
      {/* <td>Unmodeled Topics</td>
      <td>Lists the topics received in the internal broker, which can be transformed to data models. For details, see <a href="#building-models-through-mqtt">Building Models through MQTT</a>.</td> --> */}
    </tr>
    <tr>
      <td>4</td>
      <td>概述</td>
      <td>数据源与内部 MQTT 代理的连接数及消息入/出量统计。</td>
    </tr>
    <tr>
      <td>5</td>
      <td>拓扑图</td>
      <td>通过拓扑图可视化展示数据流转路径</td>
    </tr>
    <tr>
      <td>6</td>
      <td>MQTT 访问</td>
      <td>内部 MQTT 代理的详细信息，可选择已有文件查看具体负载数据。</td>
    </tr>
  </tbody>
</table>

### 补充参数定义
- **文件夹-额外设置**

<table>
<thead>
<tr>
<th>项目</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>扩展属性</strong></td>
<td>为文件夹添加扩展属性（例如：单位）。</td>
</tr>
<tr>
<td><strong>模板</strong></td>
<td>选择模板并继承其属性，详见 <a href="#创建模板">创建模板</a>。</td>
</tr>
<tr>
<td><strong>生成模板</strong></td>
<td>单击 <img src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/35.png" alt="icon" /> 为文件夹添加属性，同时可选择生成相同模板供后续使用。</td>
</tr>
</tbody>
</table>

- **文件-文件类型**

<table>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
<tr>
<td>状态</td>
<td>作为 API 接收系统状态数据。</td>
</tr>
<tr>
<td>操作</td>
<td>作为 API 执行增删改查（CRUD）命令。</td>
</tr>
<tr>
<td>指标</td>
<td>实时数据（例如：设备温度）。</td>
</tr>
</table>

- **文件-数据类型**

<table>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
<tr>
<td>时序型</td>
<td>接收实时数据并存储至 TimescaleDB。</td>
</tr>
<tr>
<td>关系型</td>
<td>接收关系型数据并存储至 Postgres 数据库。</td>
</tr>
<tr>
<td>计算型</td>
<td>对已添加的时序属性执行基础计算。</td>
</tr>
<tr>
<td>聚合</td>
<td>按固定频率将已添加数据源聚合为 JSON 格式。</td>
</tr>
<tr>
<td>引用</td>
<td>选择已有文件并复制其属性。</td>
</tr>
<tr>
<td>JSONB</td>
<td>二进制格式的 JSON 数据。</td>
</tr>
</table>

- **文件-属性生成方式**

<table>
<thead>
<tr>
<th>属性生成方式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>自定义</strong></td>
<td>手动自定义属性。</td>
</tr>
<tr>
<td><strong>模板</strong></td>
<td>从选中的模板继承属性。</td>
</tr>
<tr>
<td><strong>逆向生成</strong></td>
<td>通过 JSON 文本生成相同结构的属性。</td>
</tr>
</tbody>
</table>

- **文件-可选行为**

<table>
  <thead>
    <tr>
      <th>项目</th>
      <th>说明</th>
    </tr>
  </thead>
  <tbody>
  <tr>
      <td><strong>模拟数据</strong></td>
      <td>在 <strong>数据管理</strong> &gt; <strong>数据连接</strong> 中生成含模拟数据的数据流。</td>
    </tr>
    <tr>
      <td><strong>生成数据看板</strong></td>
      <td>在 <strong>数据管理</strong> &gt; <strong>Dashboards</strong> 中生成可视化仪表盘。</td>
    </tr>
    <tr>
      <td><strong>启用历史数据</strong></td>
      <td>为选中文件开启历史数据存储功能。</td>
    </tr>
  </tbody>
</table>

## 如何创建数据模型
基于简单的**文件夹-文件**结构，可将数据层级定义为树形视图。
### 手动创建模型

:::note
**factory/equipment/CNC** 将作为示例，其中 `factory` 和 `equipment` 为文件夹，`CNC` 为文件。
:::
1. 登录 Tier0，选择 **数据管理** > **数据建模**。
2. 在**工厂模型**栏，单击 <img src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/5.png" /> 添加文件夹（例如：`factory`）。

<img width={450} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/34-1.png" />

3. 选中**equipment**，单击 <img src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/7.png" /> 在其下添加文件（例如：`CNC`）。

<img width={450} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/36-1.png" />

4. 输入文件相关信息，单击**保存**。

### 通过 JSON 生成模型
1. 登录 Tier0，选择 **数据管理** > **数据建模**。
2. 在**工厂模型**栏，单击 <img src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/40.png" />。

<img width={350} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/40-3.png" />

3. 选择数据类型，根据数据树形结构编写模型 JSON 文本。

```json
{
    "Factory1": {
        "workshop1": {
            "equipment1": {
                "CNC1": [
                    {
                        "actualRuntime1": 1380,
                        "plannedRuntime1": 1440
                    }
                ]
            }
        }
    }
}
```

<img width={450} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/40-2.png" />

4. 单击**下一步**，在左侧选中模型。
:::tip
单击每个数据层级，可在右侧修改其信息并添加属性。
:::

<img width={450} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/41-1.png" />

5. 单击**保存**。

{/* ### Converting Models through MQTT
1. Use an MQTT client to connect to the internal broker of Tier0.
  - **Host**: Your Tier0 domain.
  - **Port**: 1883.

<img width={450} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/118.png" />

2. Define a topic and message payload on the client, and then send it to Tier0.

<img width={450} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/119.png" />

3. Log in to Tier0, and then select **UNS** > **Namespace**.
4. Expand **Unmodeled Topics**, find the topic you defined.
5. Click **Convert** icon next to the topic, and then edit the information and complete the model creation.

<img width={650} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/120.png" /> */}

### 导入模型
1. 登录 Tier0，选择**数据管理** > **数据建模**。
2. 单击右上角的**导入**。

<img width={450} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/69-4.png" />

3. 导入 JSON 创建模型：
- 直接输入 JSON 文本。

<img width={450} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/69-5.png" />

- 单击**上传文件**下载模板，按模板规则填写模型内容。

<img width={450} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/69-2.png" />

:::tip
可手动添加文件夹和文件后导出，将其作为导入示例参考。

<img width={450} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/69-6.png" />

:::

4. 保存模板文件，返回**数据建模**页面单击**导入**。
5. 选中模板文件，单击**保存**。

{/* ### Creating Models with Data Source through Source Flow
1. Log in to Tier0, and then select **UNS** > **Source Flow**.
2. Click **New Source Flow** to create a flow.
3. Click the flow and drag the **UNS Mapper** node to the canvas.
4. Double-click the node, and configure its properties.
    1. Set the node name, and then under <b>Basic Info</b>, select a protocol next to <b>Select Protocol</b> through which the data is transmitted. 

    <img width={450} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/145.png" />

    2. (Optional) Select a model next to <b>Select Model</b> to get an example for subsequent model attributes creation.
    3. Click <b>Tags Mapping</b>, click <b>New Row</b>, and then enter the model information.

    <img width={450} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/146.png" />
    <table>
    <thead>
    <tr>
    <th>Parameter</th>
    <th>Description</th>
    </tr>
    </thead>
    <tbody>
    <tr>
    <td>FilePath (Required)</td>
    <td>Namespace topic path. Use folder/file style, only last level sends data. Example: Workshop1/Line2/CNC01/SpindleTemperature.</td>
    </tr>
    <tr>
    <td>Alias (Optional)</td>
    <td>Custom alias. If blank, system auto-generates unique ID.</td>
    </tr>
    <tr>
    <td>AttributeName (Required)</td>
    <td>Key name in output JSON (e.g., value).</td>
    </tr>
    <tr>
    <td>AttributeType (Required)</td>
    <td>Data type: Float, Integer, String, or Boolean. Node auto-converts.</td>
    </tr>
    <tr>
    <td>TagConfiguration (Required)</td>
    <td>Upstream data locator. Format depends on protocol: OPC UA (nodeId), Modbus (register index), MQTT (payload path), OPC DA (tag path).</td>
    </tr>
    </tbody>
    </table>
5. Complete the node configuration, and then connect a data source node (in this example, **Modbus read**) to the **UNS Mapper** and a **mqtt out** at the end.

<img width={450} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/147.png" />

6. Edit properties of both the data source node and **mqtt out** node.

<img width={450} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/148.png" /><img width={450} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/149.png" />

:::tip
For details on property configuration of common data source nodes, see <a href="../../category/common-data-sources">Common Data Sources</a>.
:::

7. Deploy the flow and trigger it, check the data on **Namespace**.

<img width={450} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/150.png" /> */}

## 可选功能
### 创建模板
1. 在**数据建模**页面单击**模板**栏。
2. 单击<img src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/38.png" />，输入模板信息。
:::tip
单击**来源**可选择已添加的模型并继承其属性。
:::

<img width={450} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/39-1.png" />

3. 单击**保存**。

### 创建标签
标签用于对数据模型进行分类管理。
1. 在**数据建模**页面单击**标签**栏。
2. 单击<img src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/77.png" />，输入标签名称。
3. 单击**保存**，再单击<img src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/78.png" />为标签添加文件。

<img width={450} src="http://communityimage2.oss-cn-hangzhou.aliyuncs.com/79-1.png" />

4. 单击**保存**。